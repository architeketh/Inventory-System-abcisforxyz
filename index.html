<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>abc_isfor_xyz - Inventory Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs2@0.0.2/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .nav-tab {
            flex: 1;
            min-width: 100px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #e0e0e0;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 15px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .form-row {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2.5em;
            }
            
            .header p {
                font-size: 1.1em;
            }
            
            .content {
                padding: 30px;
            }
            
            .nav-tab {
                padding: 15px;
                font-size: 16px;
            }
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 5px;
            margin-bottom: 10px;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 11px;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 8px;
            overflow-x: auto;
            display: block;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        @media (min-width: 768px) {
            .inventory-table {
                display: table;
            }
        }

        .inventory-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .inventory-table th,
        .inventory-table td {
            padding: 8px;
            text-align: left;
            font-size: 11px;
        }

        @media (min-width: 768px) {
            .inventory-table th,
            .inventory-table td {
                padding: 10px;
                font-size: 12px;
            }
        }

        .inventory-table tbody tr {
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .inventory-table tbody tr:hover {
            background: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-card h3 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .search-box {
            margin-bottom: 15px;
        }

        .search-box input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 1.3em;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }

        .barcode-display {
            text-align: center;
            margin: 15px 0;
        }

        .barcode-display svg {
            max-width: 100%;
        }

        .report-section {
            margin-bottom: 30px;
        }

        .report-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
            font-size: 1.1em;
        }

        .category-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        @media (min-width: 600px) {
            .category-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 900px) {
            .category-list {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1200px) {
            .category-list {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .category-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .category-item h4 {
            color: #333;
            margin-bottom: 6px;
            font-size: 1em;
        }

        .category-item p {
            color: #666;
            font-size: 11px;
            margin: 3px 0;
        }

        .category-item .total-value {
            color: #28a745;
            font-size: 1em;
            font-weight: 700;
            margin-top: 6px;
        }

        .export-import-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .export-import-section h3 {
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .export-import-section p {
            font-size: 13px;
        }

        .file-input {
            margin: 10px 0;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .nav-tabs,
            .btn,
            .action-buttons,
            .search-box {
                display: none;
            }

            .container {
                box-shadow: none;
            }

            .inventory-table th,
            .inventory-table td {
                font-size: 9px;
                padding: 5px;
            }
        }

        .alert {
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            display: none;
            font-size: 14px;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .button-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        /* Mobile table scroll indicator */
        .table-wrapper {
            position: relative;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .table-wrapper::after {
            content: '‚Üí Scroll';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 11px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        @media (max-width: 767px) {
            .table-wrapper::after {
                opacity: 1;
            }
        }

        /* Compact report tables */
        .report-section .inventory-table {
            font-size: 10px;
        }

        .report-section .inventory-table th,
        .report-section .inventory-table td {
            padding: 6px 4px;
        }

        h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        @media (min-width: 768px) {
            h2 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>abc_isfor_xyz</h1>
            <p>Inventory Management System</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="switchTab('inventory')">Inventory</button>
            <button class="nav-tab" onclick="switchTab('add-item')">Add Item</button>
            <button class="nav-tab" onclick="switchTab('reports')">Reports</button>
            <button class="nav-tab" onclick="switchTab('data')">Data</button>
        </div>

        <div class="content">
            <div id="alert" class="alert"></div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>Dashboard</h2>
                
                <div id="empty-state" style="display: none; background: #fff3cd; border: 2px dashed #ffc107; border-radius: 12px; padding: 30px; text-align: center; margin-bottom: 20px;">
                    <h3 style="color: #856404; margin-bottom: 15px;">üëã Welcome to abc_isfor_xyz!</h3>
                    <p style="color: #856404; margin-bottom: 15px;">No inventory data on this device yet.</p>
                    <div style="text-align: left; max-width: 400px; margin: 0 auto; background: white; padding: 15px; border-radius: 8px;">
                        <p style="font-weight: 600; margin-bottom: 10px;">Get started:</p>
                        <p style="font-size: 13px; margin: 8px 0;">üì± <strong>New user?</strong> Click "Add Item" tab to add your first product</p>
                        <p style="font-size: 13px; margin: 8px 0;">üíª <strong>Have data on another device?</strong> Go to "Data" tab ‚Üí Import your JSON file</p>
                        <p style="font-size: 13px; margin: 8px 0;">üìÇ <strong>Need sample data?</strong> Import the sample file from GitHub</p>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="total-items">0</h3>
                        <p>Total Items</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <h3 id="in-stock-items">0</h3>
                        <p>Units In Stock</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <h3 id="sold-items">0</h3>
                        <p>Units Sold</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <h3 id="total-categories">0</h3>
                        <p>Categories</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <h3 id="total-value">$0.00</h3>
                        <p>Inventory Value</p>
                    </div>
                </div>

                <h3 style="margin-bottom: 10px; font-size: 1.1em;">Recent Inventory</h3>
                <div class="search-box">
                    <input type="text" id="dashboard-search" placeholder="Search inventory..." onkeyup="filterDashboard()">
                </div>
                <div class="table-wrapper">
                    <table class="inventory-table" id="dashboard-table">
                        <thead>
                            <tr>
                                <th>Barcode</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Brand</th>
                                <th>Price</th>
                                <th>Qty</th>
                                <th>Sold</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory" class="tab-content">
                <h2>Inventory Management</h2>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="printAllBarcodes()">
                        üñ®Ô∏è Print Barcodes
                    </button>
                </div>

                <div class="search-box">
                    <input type="text" id="inventory-search" placeholder="Search inventory..." onkeyup="filterInventory()">
                </div>
                <div class="table-wrapper">
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Barcode</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Brand</th>
                                <th>Price</th>
                                <th>Qty</th>
                                <th>Sold</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Item Tab -->
            <div id="add-item" class="tab-content">
                <h2>Add New Item</h2>
                <form id="add-item-form" onsubmit="addItem(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="category">Category *</label>
                            <input type="text" id="category" required list="category-list">
                            <datalist id="category-list"></datalist>
                        </div>
                        <div class="form-group">
                            <label for="brand">Brand *</label>
                            <input type="text" id="brand" required list="brand-list">
                            <datalist id="brand-list"></datalist>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="description">Description *</label>
                        <textarea id="description" rows="3" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="price">Price ($) *</label>
                            <input type="number" id="price" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="quantity">Initial Quantity *</label>
                            <input type="number" id="quantity" min="0" value="0" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Item</button>
                    <button type="reset" class="btn btn-secondary">Reset Form</button>
                </form>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2>Inventory Reports</h2>
                
                <div class="button-group">
                    <button class="btn btn-info" onclick="window.print()">Print</button>
                    <button class="btn btn-success" onclick="exportReportCSV()">Export CSV</button>
                </div>

                <div class="report-section">
                    <h3>By Category</h3>
                    <div id="category-report" class="category-list"></div>
                </div>

                <div class="report-section">
                    <h3>In Stock Items</h3>
                    <div class="table-wrapper">
                        <table class="inventory-table">
                            <thead>
                                <tr>
                                    <th>Barcode</th>
                                    <th>Category</th>
                                    <th>Description</th>
                                    <th>Brand</th>
                                    <th>Price</th>
                                    <th>Qty</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody id="instock-report-tbody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="report-section">
                    <h3>Sold Items</h3>
                    <div class="table-wrapper">
                        <table class="inventory-table">
                            <thead>
                                <tr>
                                    <th>Barcode</th>
                                    <th>Category</th>
                                    <th>Description</th>
                                    <th>Brand</th>
                                    <th>Price</th>
                                    <th>Sold</th>
                                    <th>Revenue</th>
                                </tr>
                            </thead>
                            <tbody id="sold-report-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Data Management Tab -->
            <div id="data" class="tab-content">
                <h2>Data Management</h2>
                
                <div class="export-import-section" style="background: #e7f3ff; border-left: 4px solid #2196F3;">
                    <h3>üîÑ Sync Between Devices</h3>
                    <p style="margin: 8px 0; color: #333; font-size: 13px; font-weight: 600;">
                        Each device has its own data. To see the same inventory on mobile and desktop:
                    </p>
                    <ol style="margin: 10px 0; padding-left: 20px; color: #666; font-size: 12px;">
                        <li><strong>Desktop:</strong> Export to JSON ‚Üí Upload file to GitHub</li>
                        <li><strong>Mobile:</strong> Download file from GitHub ‚Üí Import JSON</li>
                        <li>Now both devices have the same data! üéâ</li>
                    </ol>
                    <p style="margin: 8px 0; color: #d32f2f; font-size: 12px;">
                        ‚ö†Ô∏è <strong>Important:</strong> Changes on one device won't automatically appear on the other. Export and import to sync.
                    </p>
                </div>

                <div class="export-import-section" style="background: #e8f5e9; border-left: 4px solid #4CAF50;">
                    <h3>‚ö° Quick Share (Instant Sync)</h3>
                    <p style="margin: 8px 0; color: #333; font-size: 13px;">
                        <strong>Fastest way to load data on mobile!</strong> Generate a shareable link or QR code.
                    </p>
                    <button class="btn btn-success" onclick="generateShareLink()" style="margin-top: 10px;">
                        üì± Generate Share Link
                    </button>
                    
                    <div id="share-link-container" style="display: none; margin-top: 15px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #4CAF50;">
                        <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                            <strong>Share Link Generated!</strong> Use any of these methods:
                        </p>
                        
                        <div style="margin: 10px 0;">
                            <label style="font-size: 12px; font-weight: 600; color: #333;">Method 1: Click Link on Mobile</label>
                            <div style="display: flex; gap: 8px; margin-top: 5px;">
                                <input type="text" id="share-link-url" readonly style="flex: 1; padding: 8px; font-size: 11px; border: 1px solid #ddd; border-radius: 4px; background: #f5f5f5;">
                                <button class="btn btn-sm btn-primary" onclick="copyShareLink()">Copy</button>
                            </div>
                            <p style="font-size: 11px; color: #666; margin-top: 5px;">
                                üìß Send this link via email, text, or messaging app to your mobile
                            </p>
                        </div>

                        <div style="margin: 15px 0; padding-top: 15px; border-top: 1px solid #ddd;">
                            <label style="font-size: 12px; font-weight: 600; color: #333;">Method 2: Scan QR Code</label>
                            <div style="text-align: center; margin-top: 10px; padding: 15px; background: white;">
                                <div id="qr-code-display"></div>
                            </div>
                            <p style="font-size: 11px; color: #666; margin-top: 5px; text-align: center;">
                                üì∑ Open camera app on mobile and scan this QR code
                            </p>
                        </div>

                        <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 6px;">
                            <p style="font-size: 11px; color: #856404; margin: 0;">
                                ‚è±Ô∏è <strong>Note:</strong> This link contains all your inventory data and works for 7 days. Click the link on any device to instantly load the data!
                            </p>
                        </div>
                    </div>
                </div>

                <div class="export-import-section">
                    <h3>üíæ Export Data</h3>
                    <p style="margin: 8px 0; color: #666;">Download inventory as JSON to save on GitHub or backup locally.</p>
                    <button class="btn btn-primary" onclick="exportData()">Export to JSON</button>
                    <p id="export-status" style="margin-top: 8px; font-size: 12px; color: #666;"></p>
                </div>

                <div class="export-import-section">
                    <h3>üìÇ Import Data</h3>
                    <p style="margin: 8px 0; color: #666;">Import inventory from JSON file stored on GitHub or local device.</p>
                    <div class="file-input">
                        <input type="file" id="import-file" accept=".json">
                    </div>
                    <button class="btn btn-success" onclick="importData()">Import from JSON</button>
                </div>

                <div class="export-import-section">
                    <h3>‚ÑπÔ∏è Current Device Info</h3>
                    <p style="margin: 8px 0; color: #666; font-size: 12px;">
                        <strong>Items on this device:</strong> <span id="device-item-count">0</span><br>
                        <strong>Last update:</strong> <span id="last-update-time">Never</span><br>
                        <strong>Device storage:</strong> Browser localStorage
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Item</h2>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="edit-form" onsubmit="saveEdit(event)">
                <input type="hidden" id="edit-id">
                <div class="form-group">
                    <label for="edit-category">Category *</label>
                    <input type="text" id="edit-category" required list="edit-category-list">
                    <datalist id="edit-category-list"></datalist>
                </div>
                <div class="form-group">
                    <label for="edit-description">Description *</label>
                    <textarea id="edit-description" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-brand">Brand *</label>
                    <input type="text" id="edit-brand" required list="edit-brand-list">
                    <datalist id="edit-brand-list"></datalist>
                </div>
                <div class="form-group">
                    <label for="edit-price">Price ($) *</label>
                    <input type="number" id="edit-price" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="edit-quantity">Quantity *</label>
                    <input type="number" id="edit-quantity" min="0" required>
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Sell Modal -->
    <div id="sell-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Record Sale</h2>
                <button class="close-btn" onclick="closeSellModal()">&times;</button>
            </div>
            <form id="sell-form" onsubmit="recordSale(event)">
                <input type="hidden" id="sell-id">
                <div class="form-group">
                    <label>Item: <strong id="sell-item-name"></strong></label>
                </div>
                <div class="form-group">
                    <label>Available: <strong id="sell-available"></strong></label>
                </div>
                <div class="form-group">
                    <label for="sell-quantity">Quantity to Sell *</label>
                    <input type="number" id="sell-quantity" min="1" required>
                </div>
                <button type="submit" class="btn btn-success">Record Sale</button>
                <button type="button" class="btn btn-secondary" onclick="closeSellModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Barcode Modal -->
    <div id="barcode-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Barcode</h2>
                <button class="close-btn" onclick="closeBarcodeModal()">&times;</button>
            </div>
            <div class="barcode-display">
                <p><strong id="barcode-item-info"></strong></p>
                <svg id="barcode"></svg>
                <p style="margin-top: 10px; color: #667eea; font-weight: 600;">abc_isfor_xyz</p>
            </div>
            <button class="btn btn-primary" onclick="printBarcode()">Print</button>
            <button class="btn btn-secondary" onclick="closeBarcodeModal()">Close</button>
        </div>
    </div>

    <script>
        // Initialize inventory from localStorage
        let inventory = JSON.parse(localStorage.getItem('abc_inventory')) || [];
        let nextId = parseInt(localStorage.getItem('abc_next_id')) || 1;

        // Generate 6-digit barcode
        function generateBarcode(id) {
            return String(id).padStart(6, '0');
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            checkForSharedData(); // Check for shared data first
            updateDashboard();
            renderInventory();
            renderReports();
            updateDropdownLists();
        });

        // Tab switching
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const navTabs = document.querySelectorAll('.nav-tab');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'reports') {
                renderReports();
            } else if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'data') {
                updateDeviceInfo();
            }
        }

        // Add new item
        function addItem(event) {
            event.preventDefault();
            
            const item = {
                id: nextId++,
                category: document.getElementById('category').value,
                description: document.getElementById('description').value,
                brand: document.getElementById('brand').value,
                price: parseFloat(document.getElementById('price').value),
                quantity: parseInt(document.getElementById('quantity').value),
                sold: 0,
                dateAdded: new Date().toISOString()
            };

            inventory.push(item);
            saveInventory();
            
            document.getElementById('add-item-form').reset();
            showAlert('Item added! Barcode: ' + generateBarcode(item.id), 'success');
            updateDashboard();
            renderInventory();
            updateDropdownLists();
        }

        // Duplicate item
        function duplicateItem(id) {
            const item = inventory.find(i => i.id === id);
            if (!item) return;

            if (confirm('Duplicate "' + item.description + '"?')) {
                const newItem = {
                    id: nextId++,
                    category: item.category,
                    description: item.description + ' (Copy)',
                    brand: item.brand,
                    price: item.price,
                    quantity: item.quantity,
                    sold: 0,
                    dateAdded: new Date().toISOString()
                };

                inventory.push(newItem);
                saveInventory();
                showAlert('Duplicated! Barcode: ' + generateBarcode(newItem.id), 'success');
                updateDashboard();
                renderInventory();
                updateDropdownLists();
            }
        }

        // Save inventory to localStorage
        function saveInventory() {
            localStorage.setItem('abc_inventory', JSON.stringify(inventory));
            localStorage.setItem('abc_next_id', nextId.toString());
            localStorage.setItem('abc_last_update', new Date().toISOString());
        }

        // Update dashboard
        function updateDashboard() {
            const totalItems = inventory.length;
            const inStockUnits = inventory.reduce((sum, item) => sum + item.quantity, 0);
            const totalSold = inventory.reduce((sum, item) => sum + item.sold, 0);
            const categories = [...new Set(inventory.map(item => item.category))].length;
            const totalValue = inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0);

            document.getElementById('total-items').textContent = totalItems;
            document.getElementById('in-stock-items').textContent = inStockUnits;
            document.getElementById('sold-items').textContent = totalSold;
            document.getElementById('total-categories').textContent = categories;
            document.getElementById('total-value').textContent = '$' + totalValue.toFixed(2);

            // Show/hide empty state
            const emptyState = document.getElementById('empty-state');
            if (emptyState) {
                emptyState.style.display = totalItems === 0 ? 'block' : 'none';
            }

            // Update device info
            updateDeviceInfo();

            renderDashboardTable();
        }

        // Update device info
        function updateDeviceInfo() {
            const itemCountEl = document.getElementById('device-item-count');
            const lastUpdateEl = document.getElementById('last-update-time');
            
            if (itemCountEl) {
                itemCountEl.textContent = inventory.length;
            }
            
            if (lastUpdateEl) {
                const lastUpdate = localStorage.getItem('abc_last_update');
                if (lastUpdate) {
                    const date = new Date(lastUpdate);
                    lastUpdateEl.textContent = date.toLocaleString();
                } else if (inventory.length > 0) {
                    lastUpdateEl.textContent = 'Just now';
                } else {
                    lastUpdateEl.textContent = 'No data yet';
                }
            }
        }

        // Render dashboard table
        function renderDashboardTable() {
            const tbody = document.getElementById('dashboard-tbody');
            tbody.innerHTML = '';

            inventory.slice().reverse().slice(0, 15).forEach(item => {
                const row = createInventoryRow(item, false);
                tbody.appendChild(row);
            });
        }

        // Render inventory table
        function renderInventory() {
            const tbody = document.getElementById('inventory-tbody');
            tbody.innerHTML = '';

            inventory.forEach(item => {
                const row = createInventoryRow(item, true);
                tbody.appendChild(row);
            });
        }

        // Create inventory row
        function createInventoryRow(item, includeActions) {
            const row = document.createElement('tr');
            const barcode = generateBarcode(item.id);
            
            const status = item.quantity > 0 ? 
                '<span style="color: green; font-weight: 600;">In Stock</span>' : 
                '<span style="color: red; font-weight: 600;">Out</span>';

            const td1 = document.createElement('td');
            td1.innerHTML = '<strong>' + barcode + '</strong>';
            row.appendChild(td1);

            const td2 = document.createElement('td');
            td2.textContent = item.category;
            row.appendChild(td2);

            const td3 = document.createElement('td');
            td3.textContent = item.description;
            td3.style.maxWidth = '200px';
            td3.style.overflow = 'hidden';
            td3.style.textOverflow = 'ellipsis';
            td3.style.whiteSpace = 'nowrap';
            row.appendChild(td3);

            const td4 = document.createElement('td');
            td4.textContent = item.brand;
            row.appendChild(td4);

            const td5 = document.createElement('td');
            td5.textContent = '$' + item.price.toFixed(2);
            row.appendChild(td5);

            const td6 = document.createElement('td');
            td6.textContent = item.quantity;
            row.appendChild(td6);

            const td7 = document.createElement('td');
            td7.textContent = item.sold;
            row.appendChild(td7);

            const td8 = document.createElement('td');
            if (includeActions) {
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'action-buttons';

                const barcodeBtn = document.createElement('button');
                barcodeBtn.className = 'btn btn-info btn-sm';
                barcodeBtn.textContent = 'Bar';
                barcodeBtn.onclick = function() { showBarcode(item.id); };
                actionsDiv.appendChild(barcodeBtn);

                const editBtn = document.createElement('button');
                editBtn.className = 'btn btn-warning btn-sm';
                editBtn.textContent = 'Edit';
                editBtn.onclick = function() { openEditModal(item.id); };
                actionsDiv.appendChild(editBtn);

                const duplicateBtn = document.createElement('button');
                duplicateBtn.className = 'btn btn-primary btn-sm';
                duplicateBtn.textContent = 'Dup';
                duplicateBtn.onclick = function() { duplicateItem(item.id); };
                actionsDiv.appendChild(duplicateBtn);

                const sellBtn = document.createElement('button');
                sellBtn.className = 'btn btn-success btn-sm';
                sellBtn.textContent = 'Sell';
                sellBtn.disabled = item.quantity === 0;
                sellBtn.onclick = function() { openSellModal(item.id); };
                actionsDiv.appendChild(sellBtn);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger btn-sm';
                deleteBtn.textContent = 'Del';
                deleteBtn.onclick = function() { deleteItem(item.id); };
                actionsDiv.appendChild(deleteBtn);

                td8.appendChild(actionsDiv);
            } else {
                td8.innerHTML = status;
            }
            row.appendChild(td8);
            
            return row;
        }

        // Show barcode
        function showBarcode(id) {
            const item = inventory.find(i => i.id === id);
            if (!item) return;

            const barcode = generateBarcode(item.id);

            document.getElementById('barcode-item-info').textContent = 
                item.description + ' - ' + item.brand;

            JsBarcode("#barcode", barcode, {
                format: "CODE128",
                width: 2,
                height: 100,
                displayValue: true,
                text: barcode
            });

            document.getElementById('barcode-modal').classList.add('active');
        }

        function closeBarcodeModal() {
            document.getElementById('barcode-modal').classList.remove('active');
        }

        function printBarcode() {
            const barcodeContent = document.querySelector('#barcode-modal .barcode-display').innerHTML;
            const printWindow = window.open('', '', 'width=600,height=400');
            printWindow.document.write('<html><head><title>Print Barcode</title>');
            printWindow.document.write('<style>body { text-align: center; padding: 20px; font-family: Arial, sans-serif; } svg { max-width: 100%; }</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(barcodeContent);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }

        // Print all barcodes
        function printAllBarcodes() {
            if (inventory.length === 0) {
                showAlert('No items to print!', 'error');
                return;
            }

            const printWindow = window.open('', '', 'width=900,height=600');
            
            printWindow.document.write('<html><head><title>Print All Barcodes - abc_isfor_xyz</title>');
            printWindow.document.write('<scr' + 'ipt src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></scr' + 'ipt>');
            printWindow.document.write('<style>');
            printWindow.document.write('body { font-family: Arial, sans-serif; padding: 20px; }');
            printWindow.document.write('h1 { text-align: center; color: #667eea; margin-bottom: 30px; }');
            printWindow.document.write('.barcode-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }');
            printWindow.document.write('.barcode-item { border: 2px dashed #ddd; padding: 15px; text-align: center; page-break-inside: avoid; }');
            printWindow.document.write('.item-name { font-weight: 600; font-size: 14px; margin-bottom: 5px; }');
            printWindow.document.write('.item-details { font-size: 12px; color: #666; margin: 3px 0; }');
            printWindow.document.write('.barcode-container { margin: 10px 0; }');
            printWindow.document.write('.company-name { color: #667eea; font-weight: 600; font-size: 12px; margin-top: 5px; }');
            printWindow.document.write('@media print { @page { margin: 0.5in; } }');
            printWindow.document.write('</style></head><body>');
            printWindow.document.write('<h1>abc_isfor_xyz - All Inventory Barcodes</h1>');
            printWindow.document.write('<div class="barcode-grid">');

            inventory.forEach(function(item, index) {
                const barcode = generateBarcode(item.id);
                printWindow.document.write('<div class="barcode-item">');
                printWindow.document.write('<div class="item-name">' + item.description + '</div>');
                printWindow.document.write('<div class="item-details">' + item.brand + ' - ' + item.category + '</div>');
                printWindow.document.write('<div class="item-details">$' + item.price.toFixed(2) + '</div>');
                printWindow.document.write('<div class="barcode-container">');
                printWindow.document.write('<svg id="barcode-' + index + '"></svg>');
                printWindow.document.write('</div>');
                printWindow.document.write('<div class="company-name">abc_isfor_xyz</div>');
                printWindow.document.write('</div>');
            });

            printWindow.document.write('</div>');
            printWindow.document.write('<scr' + 'ipt>');

            inventory.forEach(function(item, index) {
                const barcode = generateBarcode(item.id);
                printWindow.document.write('JsBarcode("#barcode-' + index + '", "' + barcode + '", {');
                printWindow.document.write('format: "CODE128",');
                printWindow.document.write('width: 1.5,');
                printWindow.document.write('height: 60,');
                printWindow.document.write('displayValue: true,');
                printWindow.document.write('fontSize: 12');
                printWindow.document.write('});');
            });

            printWindow.document.write('setTimeout(function() { window.print(); }, 500);');
            printWindow.document.write('</scr' + 'ipt></body></html>');
            printWindow.document.close();
        }

        // Edit item
        function openEditModal(id) {
            const item = inventory.find(i => i.id === id);
            if (!item) return;

            document.getElementById('edit-id').value = item.id;
            document.getElementById('edit-category').value = item.category;
            document.getElementById('edit-description').value = item.description;
            document.getElementById('edit-brand').value = item.brand;
            document.getElementById('edit-price').value = item.price;
            document.getElementById('edit-quantity').value = item.quantity;

            updateDropdownLists();
            document.getElementById('edit-modal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.remove('active');
        }

        function saveEdit(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('edit-id').value);
            const item = inventory.find(i => i.id === id);
            
            if (item) {
                item.category = document.getElementById('edit-category').value;
                item.description = document.getElementById('edit-description').value;
                item.brand = document.getElementById('edit-brand').value;
                item.price = parseFloat(document.getElementById('edit-price').value);
                item.quantity = parseInt(document.getElementById('edit-quantity').value);

                saveInventory();
                showAlert('Item updated!', 'success');
                updateDashboard();
                renderInventory();
                renderReports();
                closeEditModal();
            }
        }

        // Sell item
        function openSellModal(id) {
            const item = inventory.find(i => i.id === id);
            if (!item || item.quantity === 0) return;

            document.getElementById('sell-id').value = item.id;
            document.getElementById('sell-item-name').textContent = item.description + ' - ' + item.brand;
            document.getElementById('sell-available').textContent = item.quantity;
            document.getElementById('sell-quantity').max = item.quantity;
            document.getElementById('sell-quantity').value = 1;

            document.getElementById('sell-modal').classList.add('active');
        }

        function closeSellModal() {
            document.getElementById('sell-modal').classList.remove('active');
        }

        function recordSale(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('sell-id').value);
            const quantity = parseInt(document.getElementById('sell-quantity').value);
            const item = inventory.find(i => i.id === id);
            
            if (item && quantity <= item.quantity) {
                item.quantity -= quantity;
                item.sold += quantity;

                saveInventory();
                showAlert('Sale recorded! ' + quantity + ' unit(s) sold.', 'success');
                updateDashboard();
                renderInventory();
                renderReports();
                closeSellModal();
            } else {
                showAlert('Invalid quantity!', 'error');
            }
        }

        // Delete item
        function deleteItem(id) {
            if (confirm('Delete this item?')) {
                inventory = inventory.filter(item => item.id !== id);
                saveInventory();
                showAlert('Item deleted!', 'success');
                updateDashboard();
                renderInventory();
                renderReports();
                updateDropdownLists();
            }
        }

        // Update dropdown lists for categories and brands
        function updateDropdownLists() {
            const categories = [...new Set(inventory.map(item => item.category))];
            const brands = [...new Set(inventory.map(item => item.brand))];
            
            const categoryLists = ['category-list', 'edit-category-list'];
            const brandLists = ['brand-list', 'edit-brand-list'];
            
            categoryLists.forEach(function(listId) {
                const datalist = document.getElementById(listId);
                datalist.innerHTML = '';
                categories.forEach(function(cat) {
                    const option = document.createElement('option');
                    option.value = cat;
                    datalist.appendChild(option);
                });
            });

            brandLists.forEach(function(listId) {
                const datalist = document.getElementById(listId);
                datalist.innerHTML = '';
                brands.forEach(function(brand) {
                    const option = document.createElement('option');
                    option.value = brand;
                    datalist.appendChild(option);
                });
            });
        }

        // Render reports
        function renderReports() {
            renderCategoryReport();
            renderInStockReport();
            renderSoldReport();
        }

        function renderCategoryReport() {
            const categoryMap = {};
            inventory.forEach(function(item) {
                if (!categoryMap[item.category]) {
                    categoryMap[item.category] = { 
                        count: 0, 
                        inStock: 0, 
                        sold: 0,
                        totalValue: 0 
                    };
                }
                categoryMap[item.category].count++;
                categoryMap[item.category].inStock += item.quantity;
                categoryMap[item.category].sold += item.sold;
                categoryMap[item.category].totalValue += (item.quantity * item.price);
            });

            const container = document.getElementById('category-report');
            container.innerHTML = '';

            const sortedCategories = Object.entries(categoryMap).sort(function(a, b) {
                return b[1].totalValue - a[1].totalValue;
            });

            sortedCategories.forEach(function(entry) {
                const category = entry[0];
                const data = entry[1];
                const div = document.createElement('div');
                div.className = 'category-item';
                div.innerHTML = '<h4>' + category + '</h4>' +
                    '<p>Items: ' + data.count + '</p>' +
                    '<p>In Stock: ' + data.inStock + '</p>' +
                    '<p>Sold: ' + data.sold + '</p>' +
                    '<p class="total-value">$' + data.totalValue.toFixed(2) + '</p>';
                container.appendChild(div);
            });
        }

        function renderInStockReport() {
            const tbody = document.getElementById('instock-report-tbody');
            tbody.innerHTML = '';

            const inStockItems = inventory.filter(function(item) {
                return item.quantity > 0;
            });

            inStockItems.forEach(function(item) {
                const totalValue = item.quantity * item.price;
                const barcode = generateBarcode(item.id);
                const row = document.createElement('tr');
                row.innerHTML = '<td><strong>' + barcode + '</strong></td>' +
                    '<td>' + item.category + '</td>' +
                    '<td style="max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">' + item.description + '</td>' +
                    '<td>' + item.brand + '</td>' +
                    '<td>$' + item.price.toFixed(2) + '</td>' +
                    '<td>' + item.quantity + '</td>' +
                    '<td style="color: #28a745; font-weight: 600;">$' + totalValue.toFixed(2) + '</td>';
                tbody.appendChild(row);
            });
        }

        function renderSoldReport() {
            const tbody = document.getElementById('sold-report-tbody');
            tbody.innerHTML = '';

            const soldItems = inventory.filter(function(item) {
                return item.sold > 0;
            });

            soldItems.forEach(function(item) {
                const revenue = item.sold * item.price;
                const barcode = generateBarcode(item.id);
                const row = document.createElement('tr');
                row.innerHTML = '<td><strong>' + barcode + '</strong></td>' +
                    '<td>' + item.category + '</td>' +
                    '<td style="max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">' + item.description + '</td>' +
                    '<td>' + item.brand + '</td>' +
                    '<td>$' + item.price.toFixed(2) + '</td>' +
                    '<td>' + item.sold + '</td>' +
                    '<td style="color: #28a745; font-weight: 600;">$' + revenue.toFixed(2) + '</td>';
                tbody.appendChild(row);
            });
        }

        // Search functions
        function filterDashboard() {
            const searchTerm = document.getElementById('dashboard-search').value.toLowerCase();
            const rows = document.getElementById('dashboard-tbody').getElementsByTagName('tr');
            
            Array.from(rows).forEach(function(row) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterInventory() {
            const searchTerm = document.getElementById('inventory-search').value.toLowerCase();
            const rows = document.getElementById('inventory-tbody').getElementsByTagName('tr');
            
            Array.from(rows).forEach(function(row) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Export data
        function exportData() {
            if (inventory.length === 0) {
                showAlert('No data to export!', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(inventory, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            const filename = 'abc_isfor_xyz_inventory_' + new Date().toISOString().split('T')[0] + '.json';
            link.download = filename;
            link.click();
            URL.revokeObjectURL(url);
            
            showAlert('Exported ' + inventory.length + ' items!', 'success');
            
            const statusEl = document.getElementById('export-status');
            if (statusEl) {
                statusEl.innerHTML = '‚úÖ <strong>File saved:</strong> ' + filename + '<br>üì± <strong>Next step:</strong> Upload this file to GitHub so you can import it on other devices!';
                statusEl.style.color = '#28a745';
            }
        }

        // Import data
        function importData() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('Please select a file to import.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedData)) {
                        throw new Error('Invalid data format');
                    }

                    if (confirm('This will replace all existing data. Continue?')) {
                        inventory = importedData;
                        nextId = Math.max.apply(Math, inventory.map(function(i) { return i.id; }).concat([0])) + 1;
                        saveInventory();
                        updateDashboard();
                        renderInventory();
                        renderReports();
                        updateDropdownLists();
                        showAlert('Data imported successfully!', 'success');
                    }
                } catch (error) {
                    showAlert('Error: Invalid JSON format', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Export reports to CSV
        function exportReportCSV() {
            let csv = 'Barcode,Category,Description,Brand,Price,Quantity,Sold,Inventory Value,Revenue\n';
            
            inventory.forEach(function(item) {
                const barcode = generateBarcode(item.id);
                const inventoryValue = (item.quantity * item.price).toFixed(2);
                const revenue = (item.sold * item.price).toFixed(2);
                csv += barcode + ',"' + item.category + '","' + item.description + '","' + item.brand + '",' + 
                       item.price + ',' + item.quantity + ',' + item.sold + ',' + inventoryValue + ',' + revenue + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'abc_isfor_xyz_report_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
            URL.revokeObjectURL(url);
            showAlert('Report exported to CSV!', 'success');
        }

        // Generate share link
        function generateShareLink() {
            if (inventory.length === 0) {
                showAlert('No data to share! Add items first.', 'error');
                return;
            }

            // Compress and encode the data
            const dataStr = JSON.stringify(inventory);
            const encoded = btoa(encodeURIComponent(dataStr));
            
            // Create share URL with data in hash
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = baseUrl + '#share=' + encoded;
            
            // Display the share link
            document.getElementById('share-link-url').value = shareUrl;
            document.getElementById('share-link-container').style.display = 'block';
            
            // Generate QR code
            const qrContainer = document.getElementById('qr-code-display');
            qrContainer.innerHTML = ''; // Clear previous QR code
            
            new QRCode(qrContainer, {
                text: shareUrl,
                width: 200,
                height: 200,
                colorDark: "#667eea",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.L
            });
            
            showAlert('Share link generated! Send to mobile device.', 'success');
        }

        // Copy share link to clipboard
        function copyShareLink() {
            const linkInput = document.getElementById('share-link-url');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                showAlert('Link copied! Paste in email/text.', 'success');
            } catch (err) {
                // Fallback for older browsers
                navigator.clipboard.writeText(linkInput.value).then(function() {
                    showAlert('Link copied! Paste in email/text.', 'success');
                }).catch(function() {
                    showAlert('Please manually copy the link.', 'error');
                });
            }
        }

        // Check for shared data on page load
        function checkForSharedData() {
            const hash = window.location.hash;
            
            if (hash.startsWith('#share=')) {
                const encoded = hash.substring(7); // Remove '#share='
                
                try {
                    const decoded = decodeURIComponent(atob(encoded));
                    const sharedData = JSON.parse(decoded);
                    
                    if (Array.isArray(sharedData) && sharedData.length > 0) {
                        // Show confirmation dialog
                        const itemCount = sharedData.length;
                        const message = 'Found ' + itemCount + ' items to import.\n\n' +
                                      'This will replace your current data (' + inventory.length + ' items).\n\n' +
                                      'Continue?';
                        
                        if (confirm(message)) {
                            inventory = sharedData;
                            nextId = Math.max.apply(Math, inventory.map(function(i) { return i.id; }).concat([0])) + 1;
                            saveInventory();
                            updateDashboard();
                            renderInventory();
                            renderReports();
                            updateDropdownLists();
                            
                            // Clear the hash to prevent re-import on refresh
                            window.location.hash = '';
                            
                            showAlert('Successfully imported ' + itemCount + ' items!', 'success');
                        } else {
                            // User declined, clear the hash
                            window.location.hash = '';
                        }
                    }
                } catch (error) {
                    console.error('Error importing shared data:', error);
                    showAlert('Error loading shared data. Link may be invalid.', 'error');
                    window.location.hash = '';
                }
            }
        }

        // Show alert
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = 'alert alert-' + type + ' show';
            
            setTimeout(function() {
                alert.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
